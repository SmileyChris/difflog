<!-- Share Status Dropdown -->
<div class="visibility-menu-wrapper" x-data="shareDropdown()" x-show="canShare" @click.outside="close()">
  <button class="visibility-status" @click="toggle()" :title="isPublic ? 'Shared publicly' : 'Private diff'">
    <span class="visibility-status-icon" :class="{ 'visibility-status-public': isPublic }">
      <!-- Open eye (public) -->
      <svg x-show="isPublic" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
        <circle cx="12" cy="12" r="3"/>
      </svg>
      <!-- Closed eye (private) -->
      <svg x-show="!isPublic" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/>
        <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/>
        <path d="M1 1l22 22"/>
      </svg>
    </span>
    <span class="visibility-status-label" x-text="isPublic ? 'public' : 'private'"></span>
  </button>
  <div class="visibility-menu" x-show="isOpen" @click.stop>
    <!-- Not shared yet -->
    <template x-if="!isPublic">
      <div class="visibility-menu-content">
        <template x-if="canModify">
          <div>
            <p class="visibility-menu-desc">Make this diff publicly viewable?</p>
            <button class="visibility-action-btn" @click="share()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              Share publicly
            </button>
          </div>
        </template>
        <template x-if="!canModify">
          <p class="visibility-menu-desc visibility-menu-paused">Sync to share this diff</p>
        </template>
      </div>
    </template>
    <!-- Already shared -->
    <template x-if="isPublic">
      <div class="visibility-menu-content">
        <div class="visibility-menu-link-row">
          <a :href="publicUrl" target="_blank" class="public-link" x-text="'/d?' + diff?.id"></a>
          <button class="visibility-menu-btn-icon" @click="copyLink()" :title="copied ? 'Copied!' : 'Copy link'">
            <span x-show="!copied">&#128203;</span>
            <span x-show="copied">&#10003;</span>
          </button>
        </div>
        <button x-show="canModify" class="visibility-action-btn visibility-action-btn-danger" @click="unshare()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/>
            <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/>
            <path d="M1 1l22 22"/>
          </svg>
          Unshare
        </button>
        <p x-show="!canModify" class="visibility-menu-desc visibility-menu-paused">Sync to unshare</p>
      </div>
    </template>
  </div>
</div>
